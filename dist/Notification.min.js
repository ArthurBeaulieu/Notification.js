"use strict";class Notification{constructor(t){return Notification.instance?Notification.instance:(Notification.instance=this,this._dismissAllLock=!1,this._dom={},this._active={},this._queue={},this._default={},this._position="",this._thickBorder="",this._duration=0,this._transition=0,this._maxActive=0,this._imgPath="",this._init(t),this._attach(),this)}_init(t){void 0===t&&(t={}),this._dom=document.createElement("DIV"),this._dom.classList.add("notification-container"),this._default={handler:{position:"top-right",thickBorder:"top",duration:5e3,transition:200,maxActive:10,imgPath:"./img/"},notification:{type:"info",message:"",title:"",iconless:!1,closable:!0,sticky:!1,renderTo:this._dom,CBtitle:"",callback:null,isDimmed:!1},color:{success:"rgb(76, 175, 80)",info:"rgb(3, 169, 244)",warning:"rgb(255, 152, 0)",error:"rgb(244, 67, 54)"}},this._setOptionsDefault(t),this._position=t.position,this._thickBorder=t.thickBorder,this._duration=t.duration,this._transition=t.transition,this._maxActive=t.maxActive,this._imgPath=t.imgPath,this._setAttributesDefault(),this._dom.classList.add(this._position)}_setOptionsDefault(t){void 0===t.position&&(t.position=this._default.handler.position),void 0===t.thickBorder&&(t.thickBorder=this._default.handler.thickBorder),void 0===t.duration&&(t.duration=this._default.handler.duration),void 0===t.transition&&(t.transition=this._default.handler.transition),void 0===t.maxActive&&(t.maxActive=this._default.handler.maxActive),void 0===t.imgPath&&(t.imgPath=this._default.handler.imgPath)}_setAttributesDefault(){"top-left"!==this._position&&"top-right"!==this._position&&"bottom-left"!==this._position&&"bottom-right"!==this._position&&(this._position=this._default.handler.position),"top"!==this._thickBorder&&"bottom"!==this._thickBorder&&"left"!==this._thickBorder&&"right"!==this._thickBorder&&"none"!==this._thickBorder&&(this._thickBorder=this._default.handler.thickBorder),("number"!=typeof this._duration||this._duration<=0)&&(this._duration=this._default.handler.duration),this._duration<2*this._transition&&(this._transition=this._default.handler.transition),("number"!=typeof this._maxActive||this._maxActive<=0)&&(this._maxActive=this._default.handler.maxActive)}_attach(){const t=document.createDocumentFragment();t.appendChild(this._dom),document.body.appendChild(t)}_events(t){let i=!1;const e=()=>{t.isDimmed&&this._unDim(t)},o=()=>{void 0!==this._active[t.id]&&(t.requestCount>1?this._decrementRequestCounter(t,!0):i||(i=!0,window.clearTimeout(t.timeoutID),t.dom.close.removeEventListener("click",o),this._close(t)))};t.sticky&&(t.dom.addEventListener("mouseenter",e.bind(this)),t.dom.addEventListener("mouseout",e.bind(this))),t.closable&&(t.dom.addEventListener("click",o.bind(this)),t.dom.close.addEventListener("click",o.bind(this))),t.dom.addEventListener("mouseover",(()=>{void 0!==this._active[t.id]&&(i||t.isDimmed||this._resetTimeout(t))}).bind(this))}_buildUI(t){if(t.requestCount=1,t.totalRequestCount=1,this._buildUIDom(t),this._buildNotificationType(t),t.iconless&&t.dom.message.classList.add("iconless-width"),t.dom.text.appendChild(t.dom.maintitle),t.dom.text.appendChild(t.dom.message),t.callback){const i=document.createElement("BUTTON");i.innerHTML=t.CBtitle,t.dom.text.appendChild(i),i.addEventListener("click",()=>{this._close(t),t.callback()})}return t.iconless||t.dom.appendChild(t.dom.icon),t.dom.appendChild(t.dom.text),t.closable&&t.dom.appendChild(t.dom.close),t}_buildUIDom(t){t.dom=document.createElement("DIV"),t.dom.icon=document.createElement("IMG"),t.dom.text=document.createElement("DIV"),t.dom.close=document.createElement("DIV"),t.dom.maintitle=document.createElement("H6"),t.dom.message=document.createElement("P"),t.dom.classList.add("notification"),t.dom.icon.classList.add("vector-container"),t.dom.text.classList.add("text-container"),t.dom.close.classList.add("close"),"top"===t.thickBorder?t.dom.classList.add("top-border"):"bottom"===t.thickBorder?t.dom.classList.add("bottom-border"):"left"===t.thickBorder?t.dom.classList.add("left-border"):"right"===t.thickBorder&&t.dom.classList.add("right-border"),t.dom.maintitle.innerHTML=t.title,t.dom.message.innerHTML=t.message,t.dom.close.innerHTML="&#x2716;"}_buildNotificationType(t){"success"===t.type||"warning"===t.type||"error"===t.type||"info"===t.type?(t.dom.classList.add(t.type),t.iconless||(t.dom.icon.src=`${this._imgPath}${t.type}.svg`)):(t.dom.classList.add("info"),t.iconless||(t.dom.icon.src=`${this._imgPath}info.svg`))}_start(t){Object.keys(this._active).length>=this._maxActive?this._queue[t.id]=t:(this._active[t.id]=t,this._events(t),this._open(t),t.timeoutID=window.setTimeout(()=>{this._checkCounter(t)},t.duration))}_open(t){"bottom-right"===this._position||"bottom-left"===this._position?t.renderTo.insertBefore(t.dom,t.renderTo.firstChild):t.renderTo.appendChild(t.dom),t.opened=Date.now(),window.setTimeout(()=>{t.dom.style.opacity=1},10)}_close(t){t.isClosing||(t.isClosing=!0,t.closed=Date.now(),t.effectiveDuration=t.closed-t.opened,t.dom.style.opacity=0,window.setTimeout(()=>{t.renderTo.removeChild(t.dom),delete this._active[t.id],Object.keys(this._queue).length>0?(this._start(this._queue[Object.keys(this._queue)[0]]),delete this._queue[Object.keys(this._queue)[0]]):0===Object.keys(this._active).length&&(this._dismissAllLock=!1)},1e3))}_incrementRequestCounter(t){++t.requestCount,t.totalRequestCount<t.requestCount&&(t.totalRequestCount=t.requestCount),t.requestCount>1&&(t.dom.counter?t.dom.counter.innerHTML=t.requestCount:(t.dom.counter=document.createElement("DIV"),t.dom.counter.classList.add("counter"),t.dom.counter.innerHTML=t.requestCount,t.dom.appendChild(t.dom.counter))),t.sticky&&t.isDimmed&&this._unDim(t)}_decrementRequestCounter(t,i){!t.sticky||i?(this._resetTimeout(t),--t.requestCount,t.requestCount>1?t.dom.counter.innerHTML=t.requestCount:(t.dom.removeChild(t.dom.counter),delete t.dom.counter)):t.isDimmed||this._dim(t)}_checkCounter(t){t.requestCount>1?this._decrementRequestCounter(t):t.renderTo.contains(t.dom)&&(window.clearTimeout(t.timeoutID),t.sticky?this._dim(t):this._close(t))}_clearRequestCount(t){t.requestCount=1,t.dom.removeChild(t.dom.counter),delete t.dom.counter}_resetTimeout(t){window.clearTimeout(t.timeoutID),t.timeoutID=window.setTimeout(()=>{this._checkCounter(t)},t.duration)}_dim(t){const i=this;let e=100;!function o(){if(e>=0&&(t.dom.style.opacity=e/100,50===--e&&t.sticky))return t.dom.style.opacity=.5,void(t.isDimmed=!0);window.setTimeout(o,i._transition/100)}()}_unDim(t){const i=this;let e=50;!function o(){if(e<100)t.dom.style.opacity=e/100,++e;else if(100===e)return t.dom.style.opacity=1,t.isDimmed=!1,void i._resetTimeout(t);window.setTimeout(o,i._transition/100)}()}new(t){if(!1===this._checkOptionsValidity(t))return console.error("Notification.js : new() options argument object is invalid."),-1;this._setOptionsFallback(t);let i=this._buildUI({id:this._idGenerator(`${t.type}${t.message}`,5),type:t.type,message:t.message,title:t.title,duration:t.duration,iconless:t.iconless,thickBorder:t.thickBorder,closable:t.closable,sticky:t.sticky,renderTo:t.renderTo,CBtitle:t.CBtitle,callback:t.callback,isDimmed:t.isDimmed});return this._active[i.id]?(this._resetTimeout(this._active[i.id]),this._incrementRequestCounter(this._active[i.id]),i={}):this._start(i),i.id}_checkOptionsValidity(t){return void 0!==t&&void 0!==t.type&&void 0!==t.message&&""!==t.message&&((!t.sticky||!1!==t.closable||void 0!==t.callback)&&("info"!==t.type&&"success"!==t.type&&"warning"!==t.type&&"error"!==t.type&&(t.type=this._default.notification.type),this._dismissAllLock&&(this._dismissAllLock=!1),!0))}_setOptionsFallback(t){void 0===t.title&&(t.title=this._default.notification.title),void 0===t.duration&&(t.duration=this._duration),void 0===t.iconless&&(t.iconless=this._default.notification.iconless),void 0===t.thickBorder&&(t.thickBorder=this._thickBorder),void 0===t.closable&&(t.closable=this._default.notification.closable),void 0===t.sticky&&(t.sticky=this._default.notification.sticky),void 0===t.renderTo&&(t.renderTo=this._default.notification.renderTo),void 0===t.CBtitle&&(t.CBtitle=this._default.notification.CBtitle),void 0===t.callback&&(t.callback=this._default.notification.callback),void 0===t.isDimmed&&(t.isDimmed=this._default.notification.isDimmed)}_idGenerator(t,i){let e=0,o="";if(!(0===t.length||i>12)){for(let i=0;i<t.length;++i)e=(e<<5)-e+(o=t.charCodeAt(i)),e|=0;return(Math.abs(e).toString(36)+""+Math.abs(e/2).toString(36).split("").reverse().join("")).substring(0,i).toUpperCase()}}info(t){if(t)return t.type="info",this.new(t);console.error("Notification.js : No arguments provided for info() method.")}success(t){if(t)return t.type="success",this.new(t);console.error("Notification.js : No arguments provided for success() method.")}warning(t){if(t)return t.type="warning",this.new(t);console.error("Notification.js : No arguments provided for warning() method.")}error(t){if(t)return t.type="error",this.new(t);console.error("Notification.js : No arguments provided for error() method.")}dismiss(t){window.clearTimeout(this._active[t].timeoutID),this._active[t].requestCount>1&&this._clearRequestCount(this._active[t]),this._close(this._active[t])}dismissAll(){if(!this._dismissAllLock&&0!==Object.keys(this._active).length){this._dismissAllLock=!0,this._queue={};for(const t in this._active)this.dismiss(t)}}dismissType(t){if(0!==Object.keys(this._active).length)for(const i in this._active)this._active[i].type===t&&this.dismiss(i)}destroy(){Notification.instance=null,document.body.removeChild(this._dom)}}export default Notification;